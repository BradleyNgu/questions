---
import MathJax from "@components/MathJax.svelte";
import Back from "@components/Back/Back.astro";
import Button from "@components/Button/Button.astro";

import { getCollection } from "astro:content";
import { default as Layout } from "src/layouts/Content/Content.astro";

export async function getStaticPaths() {
  const questions = await getCollection("questions");
  return questions
    .filter((question: any) => question.id.includes("index.md"))
    .map((page) => {
      return {
        params: { path: page.slug },
        props: { page },
      };
    });
}

const { path } = Astro.params;
const { page } = Astro.props;
const { Content } = await page.render();

// TODO we should not be generated the title of the path
function formatString(input: string) {
  let [_course, mainPart, numberPart] = input.split("/");

  mainPart = mainPart
    .split("-")
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
    .join(" ");

  return `${mainPart} - ${numberPart}`;
}

const title = formatString(path);
---

<Layout title="Welcome to Astro.">
  <div class="Question__bar">
    <div><Back href={`/evaluations`} label="Evaluations" /></div>
  </div>
  <h1>{title}</h1>
  <Content />
  <div class="Question__buttons">
    <a href={`/questions/solution/${path}`}
      ><Button
        label="Solution"
        disabled={page.data.solution ? false : true}
      /></a
    >
    <a href={`/questions/generator/${path}`}
      ><Button
        icon="mdi mdi-creation"
        label="Practice"
        disabled={page.data.generator ? false : true}
      /></a
    >
    <a
      href={`https://github.com/CarletonComputerScienceSociety/questions/blob/main/src/content/questions/${path}/index.md`}
      ><Button label="Contribute" /></a
    >
  </div>
  <MathJax client:load />
</Layout>
